æ­å–œï¼Œæˆ‘å€‘å®Œæˆäº†éšæ®µä»»å‹™ï¼
ç¾åœ¨æˆ‘è¦ç”¨ä¸Šé¢çš„result_dfè³‡æ–™ç‚ºåŸºç¤ï¼Œé€²è¡Œä»¥ä¸‹é‹ç®—ï¼š
1.æ–°å¢RT_rankæ¬„ä½ï¼š
ä»¥combinationæ¬„ä½åˆ†çµ„ï¼Œè¨ˆç®—å„çµ„returnæ¬„ä½çš„æ’å
2.æ–°å¢RT_%_Rankæ¬„ä½ï¼š
ä»¥combinationæ¬„ä½åˆ†çµ„ï¼Œæ¯çµ„returnå€¼æœ€å¤§å®šç¾©ç‚º100ã€returnå€¼æœ€å°å®šç¾©ç‚º0ï¼Œ
è¨ˆç®—æ¯å€‹returnå€¼åœ¨å„çµ„çš„æ•¸å€¼å¾Œå¡«å…¥æ­¤æ¬„ä½





===========
æˆ‘çš„pythonç¨‹å¼è¨­å®šäº†ä¸€äº›åƒæ•¸å¦‚ä¸‹ï¼š
sDt = datetime.strptime('2010/01/01', "%Y/%m/%d") # Start Date
eDt = datetime.strptime('2020/12/31', "%Y/%m/%d") # End Date
oPeriod = 3 # Observer Period (months)
hPeriod = 6 # Holding Period (months)

ç„¶å¾Œæˆ‘æœ‰ä¸€å€‹è³‡æ–™å¤¾(..\data\analysis\summary)ï¼Œ
åº•ä¸‹æœ‰å€‹å€‹å¹´åº¦è¨±å¤šæ”¯è‚¡ç¥¨çš„æ—¥æ”¶ç›¤åƒ¹ï¼Œä¾‹å¦‚æª”æ¡ˆclosePrice_2010.csvçš„éƒ¨åˆ†å…§å®¹ç¯€éŒ„ç‚ºï¼š
date,stock_id,close
2010-01-04,1101,12.18
2010-01-05,1101,12.61
2010-01-06,1101,12.88

å¹«æˆ‘å¯«ç¨‹å¼ï¼Œæ»¿è¶³ä»¥ä¸‹è¦æ±‚ï¼š
1.ç”¢ç”Ÿä¸€å€‹å«åšobserverReturnList.csvçš„æª”æ¡ˆï¼Œå­˜åˆ°è³‡æ–™å¤¾..data\analysis\momentumNewåº•ä¸‹
2.æ­¤æª”æ¡ˆçš„æ¬„ä½ç‚ºï¼šstock_id,start_date,end_date,SD_close,ED_close,combination,return_rank
3.å¡«å…¥stock_id,start_date,SD_closeæ¬„ä½ï¼š
sDtæ—¥æœŸç‚º2010/01/01ï¼Œè¡¨ç¤ºä¸€é–‹å§‹æŠŠæ™‚é–“å®šéŒ¨åœ¨2010å¹´1æœˆï¼Œè³‡æ–™æºå°æ‡‰åˆ°closePrice_2010.csvæª”æ¡ˆï¼Œ
é€æœˆæ‰¾åˆ°æ¯ä¸€éš»è‚¡ç¥¨ç•¶æœˆç¬¬ä¸€å€‹äº¤æ˜“æ—¥ï¼Œå°±æ˜¯start_dateæ¬„ä½çš„å€¼ï¼Œæ—¥æœŸæ ¼å¼ç‚ºyyyy-mm-ddï¼Œ
è€Œé€™å€‹æœˆæœƒæœ‰å¹¾ç­†è³‡æ–™å¡«å…¥ï¼Œå–æ±ºæ–¼è³‡æ–™æºæ‰¾åˆ°å¹¾å€‹ä¸åŒçš„stock_idè³‡æ–™åˆ—ã€‚
æ±ºå®šdateã€stock_idå¾Œï¼Œä¾¿èƒ½æ‰¾åˆ°è³‡æ–™æºä¸­çš„closeæ¬„ä½ï¼ŒæŠŠæ­¤å€¼å¡«å…¥åˆ°ç›®æ¨™æª”æ¡ˆçš„SD_closeæ¬„ä½
é€æœˆéæ­·çµæŸçš„æ™‚é–“é»ï¼Œç‚ºeDtçš„æ—¥æœŸï¼Œæ„å³æœ€å¾Œä¸€å€‹start_dateç‚º2020å¹´12æœˆè³‡æ–™æºæ¯æ”¯è‚¡ç¥¨æœ€æ—©çš„æ—¥æœŸ
(è·¨å¹´å¾Œè¨˜å¾—è¦æ›æª”æ¡ˆå°‹æ‰¾è³‡æ–™ï¼Œå¦‚2020å¹´çš„è³‡æ–™æºæª”æ¡ˆç‚ºclosePrice_2020.csv)


å¤ªæ£’äº†ï¼Œç¾åœ¨æˆ‘stock_id,start_date,end_date,SD_close,ED_close,combinationæ¬„ä½éƒ½æœ‰äº†
å¹«æˆ‘åŠ ä¸€å€‹returnæ¬„ä½
1.å…ˆæŠŠreturn_rankæ¬„ä½åˆªæ‰
2.returnæ¬„ä½ç‚ºä»¥SD_closeåƒ¹æ ¼è²·é€²ã€ED_closeè³£å‡ºè‚¡ç¥¨å¾—åˆ°çš„å ±é…¬ç‡


---------------
è¬è¬ ä½ å®Œæˆå¾—éå¸¸å®Œç¾ ç¾åœ¨ä¾†èªªæ˜end_date,ED_close,combinationæ¬„ä½å¦‚ä½•å¡«å¯«ï¼š
1.æ¯å€‹end_dateå’ŒåŒåˆ—çš„start_dateå›ºå®šå·®è·ç‚ºoPeriodå€‹æœˆï¼Œå¾€å›æ¨å‰æœˆæœˆåº•ï¼Œä¾‹å¦‚ï¼š
start_dateç‚ºæ¯æ”¯è‚¡ç¥¨åœ¨2010å¹´1æœˆçš„ç¬¬ä¸€å€‹dateï¼Œend_dateç‚ºè©²è‚¡ç¥¨2010å¹´3æœˆçš„æœ€å¾Œä¸€å€‹date(é–“éš”ç´„3å€‹æœˆ)
2.ED_closeå³ç‚ºend_dateå°æ‡‰çš„closeæ¬„ä½
3.combinationæ¬„ä½æ˜¯ä¸€å€‹æ ¼å¼ç‚ºyyyymm-yyyymmçš„æ¬„ä½ï¼Œçµ„åˆè¦å‰‡ç‚ºï¼š
	å‰é¢çš„yyyymmä¾†è‡ªstart_dateæ¬„ä½çš„å¹´æœˆ
	å¾Œé¢çš„yyyymmç‚ºstart_dateæ¬„ä½çš„å¹´æœˆæ¨ç§»oPeriodçš„æœˆæ•¸
	(start_dateç‚º2010-01-04,å‰‡combinationç‚º201001-201004)



--------------



================
æˆ‘æœ‰ä¸€å€‹è³‡æ–™å¤¾(..\data\FinMind\TW\DailyPriceAdj\20100101-20201231)åº•ä¸‹æœ‰è¨±å¤šcsvæª”æ¡ˆï¼Œ
å…§å®¹ç¯€éŒ„å¦‚ä¸‹ï¼š
TWDPadj-1101.csvï¼š
	date,stock_id,Trading_Volume,Trading_money,open,max,min,close,spread,Trading_turnover
	2010-01-04,1101,8299290,283529760,12.08,12.22,12.04,12.18,0.1,2839
	2010-01-05,1101,48059367,1693662333,12.29,12.72,12.25,12.61,0.43,13190
	2010-01-06,1101,36026739,1298754915,12.61,12.93,12.57,12.88,0.27,9057
	
TWDPadj-1102.csvï¼š
	date,stock_id,Trading_Volume,Trading_money,open,max,min,close,spread,Trading_turnover
	2010-01-04,1102,6528735,224652357,13.89,13.91,13.65,13.87,-0.02,2076
	2010-01-05,1102,16662766,586893853,13.93,14.37,13.89,14.17,0.3,5931
	2010-01-06,1102,15819247,564201759,14.21,14.49,14.11,14.27,0.1,4404
æˆ‘å¸Œæœ›ä½ å¯«ä¸€å€‹ç¨‹å¼ï¼Œå¹«æˆ‘æå–ã€æ•´åˆé€™äº›è³‡æ–™
1.æ¯å€‹æª”æ¡ˆæå–å…¶date,stock_id,closeæ¬„ä½
2.å°‡æ¯å€‹æª”æ¡ˆçš„è³‡æ–™ä»¥å¹´ç‚ºå–®ä½æ•´åˆåœ¨ä¸€èµ·(ä¹Ÿå°±æ˜¯æ¯å€‹æª”æ¡ˆè£¡æœƒæœ‰ä¸åŒçš„stock_idï¼Œä½†éƒ½æ˜¯åŒä¸€å¹´çš„è³‡æ–™)
3.æª”æ¡ˆä»¥å¹´ç‚ºåŠƒåˆ†ï¼Œæª”æ¡ˆåç¨±æ ¼å¼ç‚ºï¼šclosePrice_yyyy.csv
4.æª”æ¡ˆå­˜å–ç›®æ¨™è·¯å¾‘ç‚ºï¼š..\data\analysis\summary

============
é€™æ˜¯æˆ‘çš„ç¨‹å¼ç¢¼ï¼š
### æ’ˆå–FindMindçš„èª¿æ•´å¾Œè‚¡åƒ¹è³‡æ–™
outputDir = r'..\data\FinMind\TW\DailyPriceAdj'
stockList = dfTWMVrank['stock_id'].drop_duplicates().tolist()
print("ğŸ“¢ å³å°‡æ’ˆå–[æ­·å²ä¿®æ­£è‚¡åƒ¹]è³‡æ–™ï¼Œè‚¡ç¥¨æ¸…å–®çš„é•·åº¦ç‚ºï¼š", len(stockList))
for stock_id in stockList:
    outputFile = f'{outputDir}/{sDt.strftime("%Y%m%d")}-{eDt.strftime("%Y%m%d")}/TWMV-{stock_id}.csv'
    if os.path.exists(outputFile):
        print("â˜‘ï¸ æª”æ¡ˆå·²å­˜åœ¨ï¼š", outputFile)
    else:
        os.makedirs(os.path.dirname(outputFile), exist_ok=True) # ç¢ºä¿è³‡æ–™å¤¾å­˜åœ¨
        # å°ç£é‚„åŸè‚¡åƒ¹è³‡æ–™è¡¨
        dfSDA = api.taiwan_stock_daily_adj(
            stock_id=stock_id,
            start_date=sDt.strftime("%Y-%m-%d"),
            end_date=eDt.strftime("%Y-%m-%d")
        )
        dfSDA.to_csv(outputFile, index=False, encoding='utf-8-sig')
        print("âœ… æª”æ¡ˆå­˜å–æˆåŠŸï¼š", outputFile)
å› ç‚ºè¼¸å‡ºçµæœå¤§éƒ¨åˆ†çš„æª”æ¡ˆéƒ½æœ‰å›ä¾†
ä½ å¹«æˆ‘æ”¹å¯«ä¸€ä¸‹ï¼š
å¦‚æœapiå›å‚³å¤±æ•—è¨Šæ¯ï¼Œ
å°±å˜—è©¦å¹«æˆ‘ä¸€æ¬¡å–5å¹´çš„è³‡æ–™ï¼Œæ„å³10å¹´åˆ†å…©æ¬¡å–å†åˆä½µæˆæœ€å¾Œçš„csvæª”
è‹¥æ˜¯å˜—è©¦å¤±æ•—å°±æ‰“å°éŒ¯èª¤è¨Šæ¯ï¼Œç¹¼çºŒæŠ“å–ä¸‹ä¸€æ”¯è‚¡ç¥¨çš„è³‡æ–™ï¼Œä¸è¦ä¸­æ–·æŠ“å–
==============
æˆ‘æœ‰ä¸€ä»½csvè³‡æ–™æª”æ¡ˆï¼Œå…§å®¹ç¯€éŒ„å¦‚ä¸‹ï¼š
stock_id,year_month,mean_market_value
1101,2010-01,110287891611.6
1101,2010-02,97043214846.38461
1101,2010-03,97748995693.08696
1102,2010-01,100895466309.25
1102,2010-02,88710794639.07692
1102,2010-03,90188683774.56522

1.åœ¨æ­¤æª”æ¡ˆå¢åŠ rankæ¬„ä½ï¼šä¾æ“šyear_monthæ¬„ä½åˆ†çµ„ï¼Œæ¯åˆ—è³‡æ–™å¯«ä¸Šå„çµ„çš„mean_market_valueæ’å
2.å°‡rankæ¬„ä½å°æ–¼200çš„è³‡æ–™æ‹‰å‡ºä¾†å¦å­˜æˆcsvæª”


==========================
æˆ‘æœ‰å¹¾ä»½csvè³‡æ–™æª”æ¡ˆï¼Œæ”¾åœ¨dataè³‡æ–™å¤¾åº•ä¸‹ï¼Œå…§å®¹ç¯€éŒ„å¦‚ä¸‹ï¼š
TWMV-1101.csvï¼š
	date,stock_id,market_value
	2010-01-04,1101,112921632307.0
	2010-01-05,1101,116872243350.0
	2010-01-06,1101,119341375251.0

TWMV-1101B.csvï¼š
	date,stock_id,market_value
	2019-01-29,1101B,10180000000.0
	2019-01-30,1101B,10180000000.0
	2019-02-11,1101B,10200000000.0
	2019-02-12,1101B,10200000000.0
	
æˆ‘æƒ³å°æ•´å€‹dataè³‡æ–™å¤¾çš„csvæª”æ¡ˆé€²è¡Œä¸‹åˆ—è™•ç†ï¼š
1.æ¯å€‹æª”æ¡ˆåˆ†åˆ¥è¨ˆç®—å„å€‹æœˆå¹³å‡çš„market_valueï¼Œæœ€å¾Œçµæœæœƒé¡ä¼¼ï¼š
	stock_id,year_month,mean_market_value
	1101,2010-01,{mean_market_value}
	1101,2010-02,{mean_market_value}
2.ä¸Šé¢è¨ˆç®—å¹³å‡å€¼çš„æ™‚å€™ï¼Œè«‹æ’é™¤market_valueç‚ºé›¶çš„è³‡æ–™(ä¸è¨ˆå…¥åˆ†æ¯å»é™¤)
3.æ‰€æœ‰æª”æ¡ˆåˆ†åˆ¥é€²è¡Œæ­¤æ“ä½œå¾Œï¼Œè¨ˆç®—çµæœåˆä½µæˆä¸€å€‹csvæª”æ¡ˆï¼Œæ¬„ä½ç‚ºï¼š
	stock_id,year_month,mean_market_value


