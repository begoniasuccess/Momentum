恭喜，我們完成了階段任務！
現在我要用上面的result_df資料為基礎，進行以下運算：
1.新增RT_rank欄位：
以combination欄位分組，計算各組return欄位的排名
2.新增RT_%_Rank欄位：
以combination欄位分組，每組return值最大定義為100、return值最小定義為0，
計算每個return值在各組的數值後填入此欄位





===========
我的python程式設定了一些參數如下：
sDt = datetime.strptime('2010/01/01', "%Y/%m/%d") # Start Date
eDt = datetime.strptime('2020/12/31', "%Y/%m/%d") # End Date
oPeriod = 3 # Observer Period (months)
hPeriod = 6 # Holding Period (months)

然後我有一個資料夾(..\data\analysis\summary)，
底下有個個年度許多支股票的日收盤價，例如檔案closePrice_2010.csv的部分內容節錄為：
date,stock_id,close
2010-01-04,1101,12.18
2010-01-05,1101,12.61
2010-01-06,1101,12.88

幫我寫程式，滿足以下要求：
1.產生一個叫做observerReturnList.csv的檔案，存到資料夾..data\analysis\momentumNew底下
2.此檔案的欄位為：stock_id,start_date,end_date,SD_close,ED_close,combination,return_rank
3.填入stock_id,start_date,SD_close欄位：
sDt日期為2010/01/01，表示一開始把時間定錨在2010年1月，資料源對應到closePrice_2010.csv檔案，
逐月找到每一隻股票當月第一個交易日，就是start_date欄位的值，日期格式為yyyy-mm-dd，
而這個月會有幾筆資料填入，取決於資料源找到幾個不同的stock_id資料列。
決定date、stock_id後，便能找到資料源中的close欄位，把此值填入到目標檔案的SD_close欄位
逐月遍歷結束的時間點，為eDt的日期，意即最後一個start_date為2020年12月資料源每支股票最早的日期
(跨年後記得要換檔案尋找資料，如2020年的資料源檔案為closePrice_2020.csv)


太棒了，現在我stock_id,start_date,end_date,SD_close,ED_close,combination欄位都有了
幫我加一個return欄位
1.先把return_rank欄位刪掉
2.return欄位為以SD_close價格買進、ED_close賣出股票得到的報酬率


---------------
謝謝 你完成得非常完美 現在來說明end_date,ED_close,combination欄位如何填寫：
1.每個end_date和同列的start_date固定差距為oPeriod個月，往回推前月月底，例如：
start_date為每支股票在2010年1月的第一個date，end_date為該股票2010年3月的最後一個date(間隔約3個月)
2.ED_close即為end_date對應的close欄位
3.combination欄位是一個格式為yyyymm-yyyymm的欄位，組合規則為：
	前面的yyyymm來自start_date欄位的年月
	後面的yyyymm為start_date欄位的年月推移oPeriod的月數
	(start_date為2010-01-04,則combination為201001-201004)



--------------



================
我有一個資料夾(..\data\FinMind\TW\DailyPriceAdj\20100101-20201231)底下有許多csv檔案，
內容節錄如下：
TWDPadj-1101.csv：
	date,stock_id,Trading_Volume,Trading_money,open,max,min,close,spread,Trading_turnover
	2010-01-04,1101,8299290,283529760,12.08,12.22,12.04,12.18,0.1,2839
	2010-01-05,1101,48059367,1693662333,12.29,12.72,12.25,12.61,0.43,13190
	2010-01-06,1101,36026739,1298754915,12.61,12.93,12.57,12.88,0.27,9057
	
TWDPadj-1102.csv：
	date,stock_id,Trading_Volume,Trading_money,open,max,min,close,spread,Trading_turnover
	2010-01-04,1102,6528735,224652357,13.89,13.91,13.65,13.87,-0.02,2076
	2010-01-05,1102,16662766,586893853,13.93,14.37,13.89,14.17,0.3,5931
	2010-01-06,1102,15819247,564201759,14.21,14.49,14.11,14.27,0.1,4404
我希望你寫一個程式，幫我提取、整合這些資料
1.每個檔案提取其date,stock_id,close欄位
2.將每個檔案的資料以年為單位整合在一起(也就是每個檔案裡會有不同的stock_id，但都是同一年的資料)
3.檔案以年為劃分，檔案名稱格式為：closePrice_yyyy.csv
4.檔案存取目標路徑為：..\data\analysis\summary

============
這是我的程式碼：
### 撈取FindMind的調整後股價資料
outputDir = r'..\data\FinMind\TW\DailyPriceAdj'
stockList = dfTWMVrank['stock_id'].drop_duplicates().tolist()
print("📢 即將撈取[歷史修正股價]資料，股票清單的長度為：", len(stockList))
for stock_id in stockList:
    outputFile = f'{outputDir}/{sDt.strftime("%Y%m%d")}-{eDt.strftime("%Y%m%d")}/TWMV-{stock_id}.csv'
    if os.path.exists(outputFile):
        print("☑️ 檔案已存在：", outputFile)
    else:
        os.makedirs(os.path.dirname(outputFile), exist_ok=True) # 確保資料夾存在
        # 台灣還原股價資料表
        dfSDA = api.taiwan_stock_daily_adj(
            stock_id=stock_id,
            start_date=sDt.strftime("%Y-%m-%d"),
            end_date=eDt.strftime("%Y-%m-%d")
        )
        dfSDA.to_csv(outputFile, index=False, encoding='utf-8-sig')
        print("✅ 檔案存取成功：", outputFile)
因為輸出結果大部分的檔案都有回來
你幫我改寫一下：
如果api回傳失敗訊息，
就嘗試幫我一次取5年的資料，意即10年分兩次取再合併成最後的csv檔
若是嘗試失敗就打印錯誤訊息，繼續抓取下一支股票的資料，不要中斷抓取
==============
我有一份csv資料檔案，內容節錄如下：
stock_id,year_month,mean_market_value
1101,2010-01,110287891611.6
1101,2010-02,97043214846.38461
1101,2010-03,97748995693.08696
1102,2010-01,100895466309.25
1102,2010-02,88710794639.07692
1102,2010-03,90188683774.56522

1.在此檔案增加rank欄位：依據year_month欄位分組，每列資料寫上各組的mean_market_value排名
2.將rank欄位小於200的資料拉出來另存成csv檔


==========================
我有幾份csv資料檔案，放在data資料夾底下，內容節錄如下：
TWMV-1101.csv：
	date,stock_id,market_value
	2010-01-04,1101,112921632307.0
	2010-01-05,1101,116872243350.0
	2010-01-06,1101,119341375251.0

TWMV-1101B.csv：
	date,stock_id,market_value
	2019-01-29,1101B,10180000000.0
	2019-01-30,1101B,10180000000.0
	2019-02-11,1101B,10200000000.0
	2019-02-12,1101B,10200000000.0
	
我想對整個data資料夾的csv檔案進行下列處理：
1.每個檔案分別計算各個月平均的market_value，最後結果會類似：
	stock_id,year_month,mean_market_value
	1101,2010-01,{mean_market_value}
	1101,2010-02,{mean_market_value}
2.上面計算平均值的時候，請排除market_value為零的資料(不計入分母去除)
3.所有檔案分別進行此操作後，計算結果合併成一個csv檔案，欄位為：
	stock_id,year_month,mean_market_value


