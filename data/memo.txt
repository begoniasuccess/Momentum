æˆ‘æœ‰ä¸€å€‹æª”æ¡ˆè³‡æ–™(..\data\analysis\momentumNew\oPeriod3_hPeriod3\afterwardReturn-201001_202012-static2.csv)å¦‚ä¸‹ï¼š

combination,remark,count,mean_return2,
201001-201004,loser,31,-13%,
201001-201004,winner,31,-2%,
201001-201004,winner - loser,-,10%,
201002-201005,loser,31,-1%,
201002-201005,winner,31,10%,
201002-201005,winner - loser,-,11%,
201003-201006,loser,32,9%,
201003-201006,winner,32,15%,
201003-201006,winner - loser,-,6%,


==========
æˆ‘æœ‰ä¸€å€‹æª”æ¡ˆè³‡æ–™(..\data\analysis\momentumNew\oPeriod3_hPeriod3\afterwardReturn-201001_202012-static.csv)å¦‚ä¸‹ï¼š
combination,remark,count,mean_return2
201001-201004,loser,31,-0.12655181641935484
201001-201004,winner,31,-0.022821950322580647
201002-201005,loser,31,-0.006791918741935483
201002-201005,winner,31,0.09927487058064516
201003-201006,loser,32,0.089387154375
201003-201006,winner,32,0.1469420914375
201004-201007,loser,31,0.15881216193548386

æˆ‘æƒ³ä¾æ“šcombinationè¨ˆç®—winner - loserçš„mean_return2è³‡æ–™ï¼Œè®“è³‡æ–™è®Šæˆé¡ä¼¼ï¼š
combination,remark,count,mean_return2
201001-201004,loser,31,-0.12655181641935484
201001-201004,winner,31,-0.022821950322580647
201001-201004,winner - loser,-,0.103729866096774193

ä¹‹å¾Œå­˜æˆæª”æ¡ˆ..\data\analysis\momentumNew\oPeriod3_hPeriod3\afterwardReturn-201001_202012-static2.csv

æˆ‘æœ‰ä¸€å€‹æª”æ¡ˆ(..\data\analysis\momentumNew\oPeriod3_hPeriod3\afterwardReturn-201001_202012.csv)ï¼š
stock_id,start_date,end_date,SD_close,ED_close,combination,return,RT_%_Rank,remark,RT_rank,start_date2,SD_close2,end_date2,ED_close2,return2
4725,2010/1/4,2010/3/31,69.9,116.86,201001-201004,67%,99.18111293,winner,1,2010/4/1,121.73,2010/6/30,118.89,-0.023330321
6197,2010/1/4,2010/3/31,54.86,80.45,201001-201004,47%,77.81506351,winner,2,2010/4/1,79.58,2010/6/30,59.17,-0.256471475
1234,2010/1/4,2010/3/31,12.27,17.29,201001-201004,41%,71.85002593,winner,3,2010/4/1,17.29,2010/6/30,14.13,-0.182764604
2049,2010/1/4,2010/3/31,23.25,31.86,201001-201004,37%,67.81257732,winner,4,2010/4/1,33.5,2010/6/30,38.08,0.136716418

å¹«æˆ‘é€²è¡Œçµ±è¨ˆï¼Œä¸¦å­˜æˆæ–°æª”æ¡ˆ(..\data\analysis\momentumNew\oPeriod3_hPeriod3\afterwardReturn-201001_202012-static.csv)
1.æ­¤æª”æ¡ˆçš„æ¬„ä½ï¼š combination, remark, count, mean_return2
2.ä»¥combinationã€remarkæ¬„ä½åˆ†çµ„ï¼Œè¨ˆç®—æ¯ä¸€çµ„return2æ¬„ä½çš„å¹³å‡å€¼
3.countæ¬„ä½ç´€éŒ„æ˜¯å¤šå°‘å€‹return2è¨ˆç®—å‡ºçš„å¹³å‡å€¼
4.è‹¥mean_return2æ²’æœ‰è³‡æ–™å¯è¨ˆç®—å‰‡ä¸ç´€éŒ„




============
ç„¶å¾Œæˆ‘æœ‰ä¸€å€‹è³‡æ–™å¤¾(..\data\analysis\summary)ï¼Œ
åº•ä¸‹æœ‰å€‹å€‹å¹´åº¦è¨±å¤šæ”¯è‚¡ç¥¨çš„æ—¥æ”¶ç›¤åƒ¹ï¼Œä¾‹å¦‚æª”æ¡ˆclosePrice_2010.csvçš„éƒ¨åˆ†å…§å®¹ç¯€éŒ„ç‚ºï¼š
date,stock_id,close
2010-01-04,1101,12.18
2010-01-05,1101,12.61
2010-01-06,1101,12.88
å¾ä¸Šé¢å¯ä»¥çœ‹å‡ºï¼Œ2010æ˜¯è‚¡åƒ¹è³‡æ–™çš„å¹´ä»½

æˆ‘æœ‰ä¸€å€‹æª”æ¡ˆ(..\data\analysis\momentumNew\oPeriod3_hPeriod3\winner_loser-201001_202012.csv)å…§å®¹å¦‚ä¸‹ï¼š
stock_id,start_date,end_date,SD_close,ED_close,combination,return,RT_%_Rank,remark,RT_rank
1101,2010-01-04,2010-03-31,12.18,10.64,201001-201004,-0.1264367816091953,16.127972617320722,,285.0
1102,2010-01-04,2010-03-31,13.87,12.44,201001-201004,-0.10310021629416,18.555991583841823,,255.0

pythonçµ¦å®šä¸€å€‹è®Šæ•¸ï¼š
hPeriod = 3 # Holding Period

æˆ‘è¦ä½ å¹«æˆ‘é€²è¡Œä¸‹é¢æ“ä½œï¼š
1.æ–°å¢start_date2ã€SD_close2æ¬„ä½ï¼š
	å€¼åˆ†åˆ¥åƒç…§closePrice_yyyy.csvæª”æ¡ˆå…§çš„dateã€closeæ¬„ä½
	é‚è¼¯æ˜¯å‡è¨­start_dateç‚º2010-01-04ï¼Œå‰‡æ‰¾å°‹3(hPeriod)å€‹æœˆå¾Œ-2010å¹´4æœˆçš„ç¬¬ä¸€å€‹äº¤æ˜“æ—¥ï¼ŒåŒå€‹stock_idçš„è³‡æ–™åˆ—å¯«å…¥å°æ‡‰è³‡æ–™
2.æ–°å¢end_date2ã€ED_close2æ¬„ä½ï¼š
	å€¼åˆ†åˆ¥åƒç…§closePrice_yyyy.csvæª”æ¡ˆå…§çš„dateã€closeæ¬„ä½
	é‚è¼¯æ˜¯å‡è¨­end_dateç‚º2010-03-31ï¼Œå‰‡æ‰¾å°‹3(hPeriod)å€‹æœˆå¾Œ-2010å¹´6æœˆçš„æœ€å¾Œä¸€å€‹äº¤æ˜“æ—¥ï¼ŒåŒå€‹stock_idçš„è³‡æ–™åˆ—å¯«å…¥å°æ‡‰è³‡æ–™
3.æ–°å¢return2æ¬„ä½
	è¨ˆç®—ä»¥SD_close2è‚¡åƒ¹è²·å…¥ã€ED_close2è‚¡åƒ¹è³£å‡ºçš„å ±é…¬ç‡

æ“ä½œçµæœå¦å­˜æ–°æª”(..\data\analysis\momentumNew\oPeriod3_hPeriod3\afterwardReturn-201001_202012.csv)


=========
æˆ‘æœ‰ä¸€å€‹æª”æ¡ˆå…§å®¹å¦‚ä¸‹
stock_id,start_date,end_date,SD_close,ED_close,combination,return,RT_%_Rank
1101,2010-01-04,2010-03-31,12.18,10.64,201001-201004,-0.1264367816091953,16.127972617320722
1102,2010-01-04,2010-03-31,13.87,12.44,201001-201004,-0.10310021629416,18.555991583841823
1104,2010-01-04,2010-03-31,7.49,6.62,201001-201004,-0.1161548731642189,17.197738813820596

å¹«æˆ‘é€²è¡Œä¸‹é¢è™•ç†ï¼š
1.æ–°å¢remarkæ¬„ä½ï¼š
	å°‡RT_%_Rankå¤§æ–¼99.9ä»¥åŠå°æ–¼0.1çš„è³‡æ–™åˆ—å¡«å…¥"exclude"
	
2.æ–°å¢RT_rankæ¬„ä½ï¼š
	ä»¥combinationåˆ†çµ„ï¼Œæ’é™¤remarkç‚º"exclude"çš„è³‡æ–™å¾Œï¼Œå¡«å…¥returnæ¬„ä½åœ¨è©²çµ„çš„å¤§å°æ’åï¼Œ
	
3.remarkæ¬„ä½ä¾è¦å‰‡å¡«å…¥ï¼š
	ä»¥combinationåˆ†çµ„ï¼Œæ’é™¤excludeçš„è³‡æ–™å¾Œï¼Œæ¯çµ„RT_rankå€¼è½åœ¨è©²çµ„å‰10%çš„å¡«å…¥"winner"
	ä»¥combinationåˆ†çµ„ï¼Œæ¯çµ„RT_rankå€¼è½åœ¨è©²çµ„å¾Œ10%çš„å¡«å…¥"loser"



===============
æ­å–œï¼Œæˆ‘å€‘å®Œæˆäº†éšæ®µä»»å‹™ï¼
ç¾åœ¨æˆ‘è¦ç”¨ä¸Šé¢çš„result_dfè³‡æ–™ç‚ºåŸºç¤ï¼Œé€²è¡Œä»¥ä¸‹é‹ç®—ï¼š
1.æ–°å¢RT_rankæ¬„ä½ï¼š
ä»¥combinationæ¬„ä½åˆ†çµ„ï¼Œè¨ˆç®—å„çµ„returnæ¬„ä½çš„æ’å
2.æ–°å¢RT_%_Rankæ¬„ä½ï¼š
ä»¥combinationæ¬„ä½åˆ†çµ„ï¼Œæ¯çµ„returnå€¼æœ€å¤§å®šç¾©ç‚º100ã€returnå€¼æœ€å°å®šç¾©ç‚º0ï¼Œ
è¨ˆç®—æ¯å€‹returnå€¼åœ¨å„çµ„çš„æ•¸å€¼å¾Œå¡«å…¥æ­¤æ¬„ä½


===========
æˆ‘çš„pythonç¨‹å¼è¨­å®šäº†ä¸€äº›åƒæ•¸å¦‚ä¸‹ï¼š
sDt = datetime.strptime('2010/01/01', "%Y/%m/%d") # Start Date
eDt = datetime.strptime('2020/12/31', "%Y/%m/%d") # End Date
oPeriod = 3 # Observer Period (months)
hPeriod = 6 # Holding Period (months)

ç„¶å¾Œæˆ‘æœ‰ä¸€å€‹è³‡æ–™å¤¾(..\data\analysis\summary)ï¼Œ
åº•ä¸‹æœ‰å€‹å€‹å¹´åº¦è¨±å¤šæ”¯è‚¡ç¥¨çš„æ—¥æ”¶ç›¤åƒ¹ï¼Œä¾‹å¦‚æª”æ¡ˆclosePrice_2010.csvçš„éƒ¨åˆ†å…§å®¹ç¯€éŒ„ç‚ºï¼š
date,stock_id,close
2010-01-04,1101,12.18
2010-01-05,1101,12.61
2010-01-06,1101,12.88

å¹«æˆ‘å¯«ç¨‹å¼ï¼Œæ»¿è¶³ä»¥ä¸‹è¦æ±‚ï¼š
1.ç”¢ç”Ÿä¸€å€‹å«åšobserverReturnList.csvçš„æª”æ¡ˆï¼Œå­˜åˆ°è³‡æ–™å¤¾..data\analysis\momentumNewåº•ä¸‹
2.æ­¤æª”æ¡ˆçš„æ¬„ä½ç‚ºï¼šstock_id,start_date,end_date,SD_close,ED_close,combination,return_rank
3.å¡«å…¥stock_id,start_date,SD_closeæ¬„ä½ï¼š
sDtæ—¥æœŸç‚º2010/01/01ï¼Œè¡¨ç¤ºä¸€é–‹å§‹æŠŠæ™‚é–“å®šéŒ¨åœ¨2010å¹´1æœˆï¼Œè³‡æ–™æºå°æ‡‰åˆ°closePrice_2010.csvæª”æ¡ˆï¼Œ
é€æœˆæ‰¾åˆ°æ¯ä¸€éš»è‚¡ç¥¨ç•¶æœˆç¬¬ä¸€å€‹äº¤æ˜“æ—¥ï¼Œå°±æ˜¯start_dateæ¬„ä½çš„å€¼ï¼Œæ—¥æœŸæ ¼å¼ç‚ºyyyy-mm-ddï¼Œ
è€Œé€™å€‹æœˆæœƒæœ‰å¹¾ç­†è³‡æ–™å¡«å…¥ï¼Œå–æ±ºæ–¼è³‡æ–™æºæ‰¾åˆ°å¹¾å€‹ä¸åŒçš„stock_idè³‡æ–™åˆ—ã€‚
æ±ºå®šdateã€stock_idå¾Œï¼Œä¾¿èƒ½æ‰¾åˆ°è³‡æ–™æºä¸­çš„closeæ¬„ä½ï¼ŒæŠŠæ­¤å€¼å¡«å…¥åˆ°ç›®æ¨™æª”æ¡ˆçš„SD_closeæ¬„ä½
é€æœˆéæ­·çµæŸçš„æ™‚é–“é»ï¼Œç‚ºeDtçš„æ—¥æœŸï¼Œæ„å³æœ€å¾Œä¸€å€‹start_dateç‚º2020å¹´12æœˆè³‡æ–™æºæ¯æ”¯è‚¡ç¥¨æœ€æ—©çš„æ—¥æœŸ
(è·¨å¹´å¾Œè¨˜å¾—è¦æ›æª”æ¡ˆå°‹æ‰¾è³‡æ–™ï¼Œå¦‚2020å¹´çš„è³‡æ–™æºæª”æ¡ˆç‚ºclosePrice_2020.csv)


å¤ªæ£’äº†ï¼Œç¾åœ¨æˆ‘stock_id,start_date,end_date,SD_close,ED_close,combinationæ¬„ä½éƒ½æœ‰äº†
å¹«æˆ‘åŠ ä¸€å€‹returnæ¬„ä½
1.å…ˆæŠŠreturn_rankæ¬„ä½åˆªæ‰
2.returnæ¬„ä½ç‚ºä»¥SD_closeåƒ¹æ ¼è²·é€²ã€ED_closeè³£å‡ºè‚¡ç¥¨å¾—åˆ°çš„å ±é…¬ç‡


---------------
è¬è¬ ä½ å®Œæˆå¾—éå¸¸å®Œç¾ ç¾åœ¨ä¾†èªªæ˜end_date,ED_close,combinationæ¬„ä½å¦‚ä½•å¡«å¯«ï¼š
1.æ¯å€‹end_dateå’ŒåŒåˆ—çš„start_dateå›ºå®šå·®è·ç‚ºoPeriodå€‹æœˆï¼Œå¾€å›æ¨å‰æœˆæœˆåº•ï¼Œä¾‹å¦‚ï¼š
start_dateç‚ºæ¯æ”¯è‚¡ç¥¨åœ¨2010å¹´1æœˆçš„ç¬¬ä¸€å€‹dateï¼Œend_dateç‚ºè©²è‚¡ç¥¨2010å¹´3æœˆçš„æœ€å¾Œä¸€å€‹date(é–“éš”ç´„3å€‹æœˆ)
2.ED_closeå³ç‚ºend_dateå°æ‡‰çš„closeæ¬„ä½
3.combinationæ¬„ä½æ˜¯ä¸€å€‹æ ¼å¼ç‚ºyyyymm-yyyymmçš„æ¬„ä½ï¼Œçµ„åˆè¦å‰‡ç‚ºï¼š
	å‰é¢çš„yyyymmä¾†è‡ªstart_dateæ¬„ä½çš„å¹´æœˆ
	å¾Œé¢çš„yyyymmç‚ºstart_dateæ¬„ä½çš„å¹´æœˆæ¨ç§»oPeriodçš„æœˆæ•¸
	(start_dateç‚º2010-01-04,å‰‡combinationç‚º201001-201004)



--------------



================
æˆ‘æœ‰ä¸€å€‹è³‡æ–™å¤¾(..\data\FinMind\TW\DailyPriceAdj\20100101-20201231)åº•ä¸‹æœ‰è¨±å¤šcsvæª”æ¡ˆï¼Œ
å…§å®¹ç¯€éŒ„å¦‚ä¸‹ï¼š
TWDPadj-1101.csvï¼š
	date,stock_id,Trading_Volume,Trading_money,open,max,min,close,spread,Trading_turnover
	2010-01-04,1101,8299290,283529760,12.08,12.22,12.04,12.18,0.1,2839
	2010-01-05,1101,48059367,1693662333,12.29,12.72,12.25,12.61,0.43,13190
	2010-01-06,1101,36026739,1298754915,12.61,12.93,12.57,12.88,0.27,9057
	
TWDPadj-1102.csvï¼š
	date,stock_id,Trading_Volume,Trading_money,open,max,min,close,spread,Trading_turnover
	2010-01-04,1102,6528735,224652357,13.89,13.91,13.65,13.87,-0.02,2076
	2010-01-05,1102,16662766,586893853,13.93,14.37,13.89,14.17,0.3,5931
	2010-01-06,1102,15819247,564201759,14.21,14.49,14.11,14.27,0.1,4404
æˆ‘å¸Œæœ›ä½ å¯«ä¸€å€‹ç¨‹å¼ï¼Œå¹«æˆ‘æå–ã€æ•´åˆé€™äº›è³‡æ–™
1.æ¯å€‹æª”æ¡ˆæå–å…¶date,stock_id,closeæ¬„ä½
2.å°‡æ¯å€‹æª”æ¡ˆçš„è³‡æ–™ä»¥å¹´ç‚ºå–®ä½æ•´åˆåœ¨ä¸€èµ·(ä¹Ÿå°±æ˜¯æ¯å€‹æª”æ¡ˆè£¡æœƒæœ‰ä¸åŒçš„stock_idï¼Œä½†éƒ½æ˜¯åŒä¸€å¹´çš„è³‡æ–™)
3.æª”æ¡ˆä»¥å¹´ç‚ºåŠƒåˆ†ï¼Œæª”æ¡ˆåç¨±æ ¼å¼ç‚ºï¼šclosePrice_yyyy.csv
4.æª”æ¡ˆå­˜å–ç›®æ¨™è·¯å¾‘ç‚ºï¼š..\data\analysis\summary

============
é€™æ˜¯æˆ‘çš„ç¨‹å¼ç¢¼ï¼š
### æ’ˆå–FindMindçš„èª¿æ•´å¾Œè‚¡åƒ¹è³‡æ–™
outputDir = r'..\data\FinMind\TW\DailyPriceAdj'
stockList = dfTWMVrank['stock_id'].drop_duplicates().tolist()
print("ğŸ“¢ å³å°‡æ’ˆå–[æ­·å²ä¿®æ­£è‚¡åƒ¹]è³‡æ–™ï¼Œè‚¡ç¥¨æ¸…å–®çš„é•·åº¦ç‚ºï¼š", len(stockList))
for stock_id in stockList:
    outputFile = f'{outputDir}/{sDt.strftime("%Y%m%d")}-{eDt.strftime("%Y%m%d")}/TWMV-{stock_id}.csv'
    if os.path.exists(outputFile):
        print("â˜‘ï¸ æª”æ¡ˆå·²å­˜åœ¨ï¼š", outputFile)
    else:
        os.makedirs(os.path.dirname(outputFile), exist_ok=True) # ç¢ºä¿è³‡æ–™å¤¾å­˜åœ¨
        # å°ç£é‚„åŸè‚¡åƒ¹è³‡æ–™è¡¨
        dfSDA = api.taiwan_stock_daily_adj(
            stock_id=stock_id,
            start_date=sDt.strftime("%Y-%m-%d"),
            end_date=eDt.strftime("%Y-%m-%d")
        )
        dfSDA.to_csv(outputFile, index=False, encoding='utf-8-sig')
        print("âœ… æª”æ¡ˆå­˜å–æˆåŠŸï¼š", outputFile)
å› ç‚ºè¼¸å‡ºçµæœå¤§éƒ¨åˆ†çš„æª”æ¡ˆéƒ½æœ‰å›ä¾†
ä½ å¹«æˆ‘æ”¹å¯«ä¸€ä¸‹ï¼š
å¦‚æœapiå›å‚³å¤±æ•—è¨Šæ¯ï¼Œ
å°±å˜—è©¦å¹«æˆ‘ä¸€æ¬¡å–5å¹´çš„è³‡æ–™ï¼Œæ„å³10å¹´åˆ†å…©æ¬¡å–å†åˆä½µæˆæœ€å¾Œçš„csvæª”
è‹¥æ˜¯å˜—è©¦å¤±æ•—å°±æ‰“å°éŒ¯èª¤è¨Šæ¯ï¼Œç¹¼çºŒæŠ“å–ä¸‹ä¸€æ”¯è‚¡ç¥¨çš„è³‡æ–™ï¼Œä¸è¦ä¸­æ–·æŠ“å–
==============
æˆ‘æœ‰ä¸€ä»½csvè³‡æ–™æª”æ¡ˆï¼Œå…§å®¹ç¯€éŒ„å¦‚ä¸‹ï¼š
stock_id,year_month,mean_market_value
1101,2010-01,110287891611.6
1101,2010-02,97043214846.38461
1101,2010-03,97748995693.08696
1102,2010-01,100895466309.25
1102,2010-02,88710794639.07692
1102,2010-03,90188683774.56522

1.åœ¨æ­¤æª”æ¡ˆå¢åŠ rankæ¬„ä½ï¼šä¾æ“šyear_monthæ¬„ä½åˆ†çµ„ï¼Œæ¯åˆ—è³‡æ–™å¯«ä¸Šå„çµ„çš„mean_market_valueæ’å
2.å°‡rankæ¬„ä½å°æ–¼200çš„è³‡æ–™æ‹‰å‡ºä¾†å¦å­˜æˆcsvæª”


==========================
æˆ‘æœ‰å¹¾ä»½csvè³‡æ–™æª”æ¡ˆï¼Œæ”¾åœ¨dataè³‡æ–™å¤¾åº•ä¸‹ï¼Œå…§å®¹ç¯€éŒ„å¦‚ä¸‹ï¼š
TWMV-1101.csvï¼š
	date,stock_id,market_value
	2010-01-04,1101,112921632307.0
	2010-01-05,1101,116872243350.0
	2010-01-06,1101,119341375251.0

TWMV-1101B.csvï¼š
	date,stock_id,market_value
	2019-01-29,1101B,10180000000.0
	2019-01-30,1101B,10180000000.0
	2019-02-11,1101B,10200000000.0
	2019-02-12,1101B,10200000000.0
	
æˆ‘æƒ³å°æ•´å€‹dataè³‡æ–™å¤¾çš„csvæª”æ¡ˆé€²è¡Œä¸‹åˆ—è™•ç†ï¼š
1.æ¯å€‹æª”æ¡ˆåˆ†åˆ¥è¨ˆç®—å„å€‹æœˆå¹³å‡çš„market_valueï¼Œæœ€å¾Œçµæœæœƒé¡ä¼¼ï¼š
	stock_id,year_month,mean_market_value
	1101,2010-01,{mean_market_value}
	1101,2010-02,{mean_market_value}
2.ä¸Šé¢è¨ˆç®—å¹³å‡å€¼çš„æ™‚å€™ï¼Œè«‹æ’é™¤market_valueç‚ºé›¶çš„è³‡æ–™(ä¸è¨ˆå…¥åˆ†æ¯å»é™¤)
3.æ‰€æœ‰æª”æ¡ˆåˆ†åˆ¥é€²è¡Œæ­¤æ“ä½œå¾Œï¼Œè¨ˆç®—çµæœåˆä½µæˆä¸€å€‹csvæª”æ¡ˆï¼Œæ¬„ä½ç‚ºï¼š
	stock_id,year_month,mean_market_value


